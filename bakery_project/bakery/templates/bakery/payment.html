{% extends 'bakery/base.html' %}

{% block content %}
<style>
    .payment-container {
        max-width: 800px;
        margin: 40px auto;
        padding: 20px;
    }
    
    .payment-card {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    
    .order-summary {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 25px;
    }
    
    .order-summary h3 {
        color: #d2691e;
        margin-bottom: 15px;
        font-size: 18px;
    }
    
    .order-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid #e0e0e0;
    }
    
    .order-item:last-child {
        border-bottom: none;
    }
    
    .order-total {
        display: flex;
        justify-content: space-between;
        padding: 15px 0;
        margin-top: 10px;
        border-top: 2px solid #d2691e;
        font-weight: bold;
        font-size: 18px;
        color: #d2691e;
    }
    
    .payment-method {
        margin: 25px 0;
    }
    
    .payment-method h3 {
        margin-bottom: 15px;
    }
    
    .payment-method input[type="radio"] {
        display: none;
    }
    
    .payment-method label {
        display: block;
        padding: 15px 20px;
        margin: 10px 0;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .payment-method label i {
        font-size: 24px;
        color: #d2691e;
    }
    
    .payment-method input[type="radio"]:checked + label {
        border-color: #d2691e;
        background: #fff5ee;
    }
    
    .payment-details {
        display: none;
        margin: 20px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
    }
    
    .payment-details.active {
        display: block;
    }
    
    .payment-details h4 {
        color: #d2691e;
        margin-bottom: 15px;
    }
    
    .payment-input {
        width: 100%;
        padding: 12px 15px;
        margin: 10px 0;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 14px;
    }
    
    .payment-input:focus {
        outline: none;
        border-color: #d2691e;
    }
    
    .pay-button {
        width: 100%;
        padding: 15px;
        background: linear-gradient(135deg, #d2691e, #8b4513);
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 20px;
    }
    
    .pay-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(210, 105, 30, 0.3);
    }
    
    .pay-button:disabled {
        background: #ccc;
        cursor: not-allowed;
    }
</style>
 <div class="payment-container">
        <div class="payment-card">
            <h2 style="color: #d2691e; margin-bottom: 20px;">
              Complete Your Payment
            </h2>
            
            <!-- Order Summary -->
            <div class="order-summary">
                <h3>Order Summary</h3>
                <div id="orderItems"></div>
                <div class="order-item">
                    <span>Subtotal:</span>
                    <span id="subtotal">₹0.00</span>
                </div>
                <div class="order-item">
                    <span>Delivery Fee:</span>
                    <span id="deliveryFee">₹50.00</span>
                </div>
                <div class="order-total">
                    <span>Total Amount:</span>
                    <span id="totalAmount">₹0.00</span>
                </div>
            </div>
            
            <!-- Payment Methods -->
            <div class="payment-method">
                <h3 style="color: #d2691e; margin-bottom: 15px;">Select Payment Method</h3>
                
                <input type="radio" name="payment_method" id="upi" value="UPI" checked>
                <label for="upi">
                    <i class="ri-smartphone-line"></i> UPI Payment
                </label>
                
                <input type="radio" name="payment_method" id="bank" value="BANK">
                <label for="bank">
                    <i class="ri-bank-line"></i> Bank Account
                </label>
                
                <input type="radio" name="payment_method" id="card" value="CARD">
                <label for="card">
                    <i class="ri-bank-card-line"></i> Credit/Debit Card
                </label>
            </div>
            
            <!-- UPI Payment Details -->
            <div class="payment-details active" id="upiDetails">
                <!-- <h4>UPI Payment Details</h4>
                <input type="text" class="payment-input" id="upiId" placeholder="Enter UPI ID (e.g., username@paytm)">
                <p style="color: #666; font-size: 12px;">
                    <i class="ri-information-line"></i> Enter your UPI ID to complete the payment
                </p> -->
            </div>
            
            <!-- Bank Payment Details -->
            <div class="payment-details" id="bankDetails">
                <h4>Bank Account Details</h4>
                <input type="text" class="payment-input" id="bankName" placeholder="Bank Name">
                <input type="text" class="payment-input" id="accountNumber" placeholder="Account Number">
                <p style="color: #666; font-size: 12px;">
                    <i class="ri-shield-check-line"></i> Your payment will be securely processed
                </p>
            </div>
            
            <!-- Card Payment Details -->
            <div class="payment-details" id="cardDetails">
                <h4>Card Details</h4>
                <input type="text" class="payment-input" placeholder="Card Number" maxlength="16">
                <div style="display: flex; gap: 10px;">
                    <input type="text" class="payment-input" placeholder="MM/YY" style="flex: 1;">
                    <input type="text" class="payment-input" placeholder="CVV" maxlength="3" style="flex: 1;">
                </div>
                <input type="text" class="payment-input" placeholder="Cardholder Name">
            </div>
            
            <!-- Pay Button -->
            <a href="{% url 'upi_payment' %}" style="text-decoration: none;">
                <button class="pay-button" id="payButton" type="button">
                    Pay Now
                </button>
            </a>
        </div>
        
        <!-- Payment Success Message -->
        <!-- <div class="payment-success" id="paymentSuccess">
            <i class="ri-checkbox-circle-fill"></i>
            <h2>Payment Successful!</h2>
            <p>Your payment has been verified and processed successfully.</p>
            <p><strong>Order ID:</strong> <span id="successOrderId"></span></p>
            <p><strong>Transaction ID:</strong> <span id="successTransactionId"></span></p>
            <button class="pay-button" style="margin-top: 20px; max-width: 300px; margin-left: auto; margin-right: auto;" 
                    onclick="window.location.href='/html/orders.html'">
                View My Orders
            </button>
        </div> -->
    </div>

{% endblock %}

{% block extra_js %}
<script>
     function updateCartDisplay() {
            const cartData = JSON.parse(localStorage.getItem('bakeryCart')) || {};
            const totalQuantity = Object.values(cartData).reduce((sum, item) => sum + item.quantity, 0);
            const totalPrice = Object.values(cartData).reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            const navQuantity = document.querySelector('#quantity');
            const cartPrice = document.querySelector('#cart_price');
            
            if (navQuantity) navQuantity.textContent = totalQuantity;
            if (cartPrice) cartPrice.textContent = `₹${totalPrice.toFixed(2)}`;
        }
        
        // Load cart display when page loads
        document.addEventListener('DOMContentLoaded', updateCartDisplay);
    
    // Function to format numbers as currency

    function formatCurrency(amount) {
        return `₹${amount.toFixed(2)}`;
    }

    // Function to load order summary from localStorage
    function loadOrderSummary() {
        const cartData = JSON.parse(localStorage.getItem('bakeryCart')) || {};
        const orderItemsContainer = document.getElementById('orderItems');
        const subtotalElem = document.getElementById('subtotal');
        const deliveryFeeElem = document.getElementById('deliveryFee');
        const totalAmountElem = document.getElementById('totalAmount');

        orderItemsContainer.innerHTML = '';
        let subtotal = 0;

        Object.entries(cartData).forEach(([itemName, item]) => {
            const itemTotal = item.price * item.quantity;
            subtotal += itemTotal;

            const itemDiv = document.createElement('div');
            itemDiv.className = 'order-item';
            itemDiv.innerHTML = `
                <span>${itemName} x ${item.quantity}</span>
                <span>${formatCurrency(itemTotal)}</span>
            `;
            orderItemsContainer.appendChild(itemDiv);
        });

        const deliveryFee = 50.00; // Fixed delivery fee
        const totalAmount = subtotal + deliveryFee;

        subtotalElem.textContent = formatCurrency(subtotal);
        deliveryFeeElem.textContent = formatCurrency(deliveryFee);
        totalAmountElem.textContent = formatCurrency(totalAmount);
    }
    // Function to handle payment method selection
    function handlePaymentMethodChange() {  

        const paymentMethods = document.getElementsByName('payment_method');
        const upiDetails = document.getElementById('upiDetails');
        const bankDetails = document.getElementById('bankDetails');
        const cardDetails = document.getElementById('cardDetails');

        paymentMethods.forEach(method => {
            method.addEventListener('change', () => {
                upiDetails.classList.remove('active');
                bankDetails.classList.remove('active');
                cardDetails.classList.remove('active');

                if (method.checked) {
                    if (method.value === 'UPI') {
                        upiDetails.classList.add('active');
                    } else if (method.value === 'BANK') {
                        bankDetails.classList.add('active');
                    } else if (method.value === 'CARD') {
                        cardDetails.classList.add('active');
                    }
                }
            });
        });
    }

    // Function to handle payment processing
    function processPayment() {
        const selectedPaymentMethod = document.querySelector('input[name="payment_method"]:checked').value;
        
        if (selectedPaymentMethod === 'UPI') {
            // Redirect to UPI payment page
            window.location.href = "{% url 'upi_payment' %}";
            return;
        }

        // For other payment methods, simulate payment processing
        const payButton = document.getElementById('payButton');
        payButton.disabled = true;
        payButton.textContent = 'Processing...';

        setTimeout(() => {
            // Simulate successful payment
            const orderId = 'ORD' + Math.floor(Math.random() * 1000000);
            const transactionId = 'TXN' + Math.floor(Math.random() * 1000000);

            document.getElementById('successOrderId').textContent = orderId;
            document.getElementById('successTransactionId').textContent = transactionId;

            document.querySelector('.payment-card').style.display = 'none';
            document.getElementById('paymentSuccess').style.display = 'block';

            // Clear cart after successful payment
            localStorage.removeItem('bakeryCart');
            updateCartDisplay();
        }, 2000);
    }

    document.addEventListener('DOMContentLoaded', () => {
        loadOrderSummary();
        handlePaymentMethodChange();

        document.getElementById('payButton').addEventListener('click', processPayment);
    });

    

    // Update cart display on page load
    function updateCartDisplay() {  
        const cartData = JSON.parse(localStorage.getItem('bakeryCart')) || {};
        const totalQuantity = Object.values(cartData).reduce((sum, item) => sum + item.quantity, 0);
        const totalPrice = Object.values(cartData).reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        const navQuantity = document.querySelector('#quantity');
        const cartPrice = document.querySelector('#cart_price');
        
        if (navQuantity) navQuantity.textContent = totalQuantity;
        if (cartPrice) cartPrice.textContent = `₹${totalPrice.toFixed(2)}`;
    }

    // Load cart display when page loads
    document.addEventListener('DOMContentLoaded', updateCartDisplay);

    // Load order summary when page loads
    document.addEventListener('DOMContentLoaded', loadOrderSummary);    
    document.addEventListener('DOMContentLoaded', handlePaymentMethodChange);
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('payButton').addEventListener('click', processPayment);
    }); 

    // Initial call to set up cart display
    updateCartDisplay();
    loadOrderSummary();
    handlePaymentMethodChange();
    document.getElementById('payButton').addEventListener('click', processPayment);

   // Initial call to set up cart display
   updateCartDisplay();
   loadOrderSummary();
   handlePaymentMethodChange();
   document.getElementById('payButton').addEventListener('click', processPayment);

</script>
{% endblock %}
